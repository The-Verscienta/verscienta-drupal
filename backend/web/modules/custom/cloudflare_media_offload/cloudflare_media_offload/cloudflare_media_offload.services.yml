services:
  cloudflare_media_offload.api_client:
    class: Drupal\cloudflare_media_offload\Service\CloudflareApiClient
    arguments: ['@http_client', '@config.factory', '@key.repository', '@logger.channel.cloudflare_media_offload']

  cloudflare_media_offload.image_validator:
    class: Drupal\cloudflare_media_offload\Service\ImageValidator
    arguments: ['@config.factory']

  cloudflare_media_offload.variant_manager:
    class: Drupal\cloudflare_media_offload\Service\VariantManager
    arguments: ['@config.factory', '@cloudflare_media_offload.api_client']

  cloudflare_media_offload.flysystem_adapter:
    class: Drupal\cloudflare_media_offload\Flysystem\CloudflareAdapter
    arguments: ['@cloudflare_media_offload.api_client', '@logger.channel.cloudflare_media_offload']

  cloudflare_media_offload.media_subscriber:
    class: Drupal\cloudflare_media_offload\EventSubscriber\MediaEntitySubscriber
    arguments: ['@config.factory', '@cloudflare_media_offload.api_client', '@queue', '@logger.channel.cloudflare_media_offload', '@cloudflare_media_offload.image_validator']

  cloudflare_media_offload.stream_wrapper:
    class: Drupal\cloudflare_media_offload\StreamWrapper\CloudflareStream
    tags:
      - { name: stream_wrapper, scheme: cloudflare }

  cloudflare_media_offload.commands:
    class: Drupal\cloudflare_media_offload\Commands\CloudflareCommands
    arguments: ['@config.factory', '@entity_type.manager', '@cloudflare_media_offload.api_client', '@queue']
    tags:
      - { name: drush.command }

  logger.channel.cloudflare_media_offload:
    parent: logger.channel_base
    arguments: ['cloudflare_media_offload']